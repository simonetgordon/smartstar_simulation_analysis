# Bfore supernova plots in one figure

import yt
import ytree
import numpy as np
import matplotlib.pyplot as plt
from yt.extensions.p2p import add_p2p_fields, add_p2p_particle_filters
from matplotlib.lines import Line2D # for custom legend

# Position of star at formation = [0.49053251 0.4946698  0.50963437]

# Load snapshots and add pop3/metallicity fields+filters

# t = 125.3, just after star formation

# For Rays10
ds_10_1 = yt.load("DD0125/DD0125") # t = 126.3, 1 Myr after star particle inserted
ds_10_2 = yt.load("DD0126/DD0126") # t = 127.3, 2 Myr after star particle inserted
ds_10_3 = yt.load("DD0127/DD0127") # t = 128.3, 3 Myr after star particle inserted

# For Rays7
ds_7_1 = yt.load("../star_raysPerCell_7/DD0126/DD0126") # 126.3
ds_7_2 = yt.load("../star_raysPerCell_7/DD0128/DD0128") # 127.3
ds_7_3 = yt.load("../star_raysPerCell_7/DD0130/DD0130") # 128.3

# For Rays5.1
ds_5_1 = yt.load("../star_raysPerCell_5.1/DD0126/DD0126")
ds_5_2 = yt.load("../star_raysPerCell_5.1/DD0128/DD0128")
ds_5_3 = yt.load("../star_raysPerCell_5.1/DD0130/DD0130")

# Make array of all data
DD = [ds_10_1, ds_10_2, ds_10_3, ds_7_1, ds_7_2, ds_7_3, ds_5_1, ds_5_2, ds_5_3]

# Define dark_matter_mass field

def _dm_mass(field, data):
    return data[("gas", "dark_matter_density")].in_units("g/cm**3") * data[("index", "cell_volume")].in_units("cm**3")

for ds in DD:
    # Add  dm_mass field to ds
    ds.add_field(("gas",'dm_mass'),function=_dm_mass, units = "g", sampling_type= 'cell') # need to define with units here.

    # Add p2p fields and filters
    add_p2p_fields(ds)
    add_p2p_particle_filters(ds)

## Make Sphere of Most Massive Halo ##

# Load merger tree of dataset (up to DD0118 in gas run)
a = ytree.load('../gas+dm-L3/rockstar_halos/out_0.list')

# Load my_tree and find radius
a1 = ytree.load('../gas+dm-L3/tree_810/tree_810.h5')

r_halo = a1[0]["virial_radius"].to('pc')
r = ds_10_1.quan(r_halo.d, "pc") # virial radius

# Make initial sphere centred on the star at the time of formation (DD0122) with radius = 5 * virial radius

star_pos0 = [0.49053251, 0.4946698, 0.50963437]
sp10_a = ds_10_1.sphere(star_pos0, 5*r)
sp10_b = ds_10_2.sphere(star_pos0, 5*r)
sp10_c = ds_10_3.sphere(star_pos0, 5*r)

sp7_a = ds_7_1.sphere(star_pos0, 5*r)
sp7_b = ds_7_2.sphere(star_pos0, 5*r)
sp7_c = ds_7_3.sphere(star_pos0, 5*r)

sp5_a = ds_5_1.sphere(star_pos0, 5*r)
sp5_b = ds_5_2.sphere(star_pos0, 5*r)
sp5_c = ds_5_3.sphere(star_pos0, 5*r)
 # need to do individual spheres


## Make Profile Plots ##

    
# Print out Pop III star mass and make sphere centred on current star

star_pos10_1 = sp10_a['pop3', 'particle_position']
star_pos10_2 = sp10_b['pop3', 'particle_position']
star_pos10_3 = sp10_c['pop3', 'particle_position']

star_pos7_1 = sp7_a['pop3', 'particle_position']
star_pos7_2 = sp7_b['pop3', 'particle_position']
star_pos7_3 = sp7_c['pop3', 'particle_position']

star_pos5_1 = sp5_a['pop3', 'particle_position']
star_pos5_2 = sp5_b['pop3', 'particle_position']
star_pos5_3 = sp5_c['pop3', 'particle_position']

# sphere around current star position
sp10_1 = ds_10_1.sphere(star_pos10_1, 3*r)
sp10_2 = ds_10_2.sphere(star_pos10_2, 3*r)
sp10_3 = ds_10_3.sphere(star_pos10_3, 3*r)

sp7_1 = ds_7_1.sphere(star_pos7_1, 3*r)
sp7_2 = ds_7_2.sphere(star_pos7_2, 3*r)
sp7_3 = ds_7_3.sphere(star_pos7_3, 3*r)

sp5_1 = ds_5_1.sphere(star_pos5_1, 3*r)
sp5_2 = ds_5_2.sphere(star_pos5_2, 3*r)
sp5_3 = ds_5_3.sphere(star_pos5_3, 3*r)

all_spheres = [sp10_1 , sp10_2, sp10_2, sp7_1, sp7_2, sp7_3, sp5_1, sp5_2, sp5_3]


# Bin up the data from the sphere into radial profiles.

# Radial profile weighted by default = 'cell_mass'. (WAS RP)
rp10_mass_1 = yt.create_profile(
    sp10_1,
    "radius",
    ["density", "temperature", "H2_p0_fraction", "radial_velocity", "cell_mass", "matter_mass", "cell_volume"], # 'dm_mass' raises error if put here.
    units={"radius": "pc", "cell_mass": "Msun", "matter_mass": "Msun", "density": "g/cm**3"},
    logs={"radius": True} # Set true for more bins
)

# NEED PANDAS
#df1 = rp10_mass_1.to_dataframe(fields=["temperature", "radius"], only_used=True)

# delete zeros for temperature plot
rp10_mass_1_temp = np.delete(rp10_mass_1["temperature"], [1,2,3])
rp10_mass_1_rad = np.delete(rp10_mass_1.x.value, [1,2,3])

# delete zeros for h2 fraction plot
rp10_mass_1_h2 = np.delete(rp10_mass_1["H2_p0_fraction"], [1,2,3])


rp10_mass_2 = yt.create_profile(
    sp10_2,
    "radius",
    ["density", "temperature", "H2_p0_fraction", "radial_velocity", "cell_mass", "matter_mass", "cell_volume"], # 'dm_mass' raises error if put here.
    units={"radius": "pc", "cell_mass": "Msun", "matter_mass": "Msun", "density": "g/cm**3"},
    logs={"radius": True} # Set true for more bins
)

# delete zeros for temperature plot
rp10_mass_2_temp= np.delete(rp10_mass_2["temperature"], [1,2,3,4])
rp10_mass_2_rad = np.delete(rp10_mass_2.x.value, [1,2,3,4])

# delete zeros for h2 fraction plot
rp10_mass_2_h2 = np.delete(rp10_mass_2["H2_p0_fraction"], [1,2,3,4])


rp10_mass_3 = yt.create_profile(
    sp10_3,
    "radius",
    ["density", "temperature", "H2_p0_fraction", "radial_velocity", "cell_mass", "matter_mass", "cell_volume"], # 'dm_mass' raises error if put here.
    units={"radius": "pc", "cell_mass": "Msun", "matter_mass": "Msun", "density": "g/cm**3"},
    logs={"radius": True} # Set true for more bins
)

rp10_mass_3_temp= np.delete(rp10_mass_3["temperature"], [1,2,3,4])
rp10_mass_3_rad = np.delete(rp10_mass_3.x.value, [1,2,3,4])

# delete zeros for h2 fraction plot
rp10_mass_3_h2 = np.delete(rp10_mass_3["H2_p0_fraction"], [1,2,3,4])


# Radial profile weighted by default = 'cell_mass'.
rp7_mass_1 = yt.create_profile(
    sp7_1,
    "radius",
    ["density", "temperature", "H2_p0_fraction", "radial_velocity", "cell_mass", "matter_mass", "cell_volume"], # 'dm_mass' raises error if put here.
    units={"radius": "pc", "cell_mass": "Msun", "matter_mass": "Msun", "density": "Msun/cm**3"},
    logs={"radius": True} # Set true for more bins
)

# delete zeros for temperature plot
rp7_mass_1_temp = np.delete(rp7_mass_1["temperature"], [1,2])
rp7_mass_1_rad = np.delete(rp7_mass_1.x.value, [1,2])

# delete zeros for h2 fraction plot
rp7_mass_1_h2 = np.delete(rp7_mass_1["H2_p0_fraction"], [1,2])

rp7_mass_2 = yt.create_profile(
    sp7_2,
    "radius",
    ["density", "temperature", "H2_p0_fraction", "radial_velocity", "cell_mass", "matter_mass", "cell_volume"], # 'dm_mass' raises error if put here.
    units={"radius": "pc", "cell_mass": "Msun", "matter_mass": "Msun", "density": "Msun/cm**3"},
    logs={"radius": True} # Set true for more bins
)

# delete zeros for temperature plot
rp7_mass_2_temp = np.delete(rp7_mass_2["temperature"], [1,2,4])
rp7_mass_2_rad = np.delete(rp7_mass_2.x.value, [1,2,4])

# delete zeros for h2 fraction plot
rp7_mass_2_h2 = np.delete(rp7_mass_2["H2_p0_fraction"], [1,2,4])

rp7_mass_3 = yt.create_profile(
    sp7_3,
    "radius",
    ["density", "temperature", "H2_p0_fraction", "radial_velocity", "cell_mass", "matter_mass", "cell_volume"], # 'dm_mass' raises error if put here.
    units={"radius": "pc", "cell_mass": "Msun", "matter_mass": "Msun", "density": "Msun/cm**3"},
    logs={"radius": True} # Set true for more bins
)

# delete zeros for temperature plot
rp7_mass_3_temp = np.delete(rp7_mass_3["temperature"], 3)
rp7_mass_3_rad = np.delete(rp7_mass_3.x.value, 3)

# delete zeros for h2 fraction plot
rp7_mass_3_h2 = np.delete(rp7_mass_3["H2_p0_fraction"], 3)


# Radial profile weighted by default = 'cell_mass'.
rp5_mass_1 = yt.create_profile(
    sp5_1,
    "radius",
    ["density", "temperature", "H2_p0_fraction", "radial_velocity", "cell_mass", "matter_mass", "cell_volume"], # 'dm_mass' raises error if put here.
    units={"radius": "pc", "cell_mass": "Msun", "matter_mass": "Msun", "density": "Msun/cm**3"},
    logs={"radius": True} # Set true for more bins
)

# delete zeros for temperature plot
rp5_mass_1_temp = np.delete(rp5_mass_1["temperature"], [1,3])
rp5_mass_1_rad = np.delete(rp5_mass_1.x.value, [1,3])

# delete zeros for h2 fraction plot
rp5_mass_1_h2 = np.delete(rp5_mass_1["H2_p0_fraction"], [1,3])



rp5_mass_2 = yt.create_profile(
    sp5_2,
    "radius",
    ["density", "temperature", "H2_p0_fraction", "radial_velocity", "cell_mass", "matter_mass", "cell_volume"], # 'dm_mass' raises error if put here.
    units={"radius": "pc", "cell_mass": "Msun", "matter_mass": "Msun", "density": "Msun/cm**3"},
    logs={"radius": True} # Set true for more bins
)

rp5_mass_2_temp = np.delete(rp5_mass_2["temperature"], [1,2,3])
rp5_mass_2_rad = np.delete(rp5_mass_2.x.value, [1,2,3])

# delete zeros for h2 fraction plot
rp5_mass_2_h2 = np.delete(rp5_mass_2["H2_p0_fraction"], [1,2,3])

rp5_mass_3 = yt.create_profile(
    sp5_3,
    "radius",
    ["density", "temperature", "H2_p0_fraction", "radial_velocity", "cell_mass", "matter_mass", "cell_volume"], # 'dm_mass' raises error if put here.
    units={"radius": "pc", "cell_mass": "Msun", "matter_mass": "Msun", "density": "Msun/cm**3"},
    logs={"radius": True} # Set true for more bins
)

rp5_mass_3_temp = np.delete(rp5_mass_3["temperature"], [1,2])
rp5_mass_3_rad = np.delete(rp5_mass_3.x.value, [1,2])

# delete zeros for h2 fraction plot
rp5_mass_3_h2 = np.delete(rp5_mass_3["H2_p0_fraction"], [1,2])


# Radial profile weighted by 'cell_volume'. For densities. (WAS RP2)

# Rays10
rp10_vol_1 = yt.create_profile(
    sp10_1,
    "radius",
    ["cell_volume", "radius", "matter_density", "density", "Dark_Matter_Density"], # 'dm_mass' also raises error here.
    units={"radius": "pc", "Dark_Matter_Density": "g/cm**3", "matter_density": "g/cm**3", "density": "g/cm**3"},
    weight_field='cell_volume',
    accumulation=True,
    logs={"radius": True} # Set true for more bins
)

rp10_vol_2 = yt.create_profile(
    sp10_2,
    "radius",
    ["cell_volume", "radius", "matter_density", "density", "Dark_Matter_Density"], # 'dm_mass' also raises error here.
    units={"radius": "pc", "Dark_Matter_Density": "g/cm**3", "matter_density": "g/cm**3", "density": "g/cm**3"},
    weight_field='cell_volume',
    accumulation=True,
    logs={"radius": True} # Set true for more bins
)

rp10_vol_3 = yt.create_profile(
    sp10_3,
    "radius",
    [ "cell_volume", "radius", "matter_density", "density", "Dark_Matter_Density"], # 'dm_mass' also raises error here.
    units={"radius": "pc", "Dark_Matter_Density": "g/cm**3", "matter_density": "g/cm**3", "density": "g/cm**3"},
    weight_field='cell_volume',
    accumulation=True,
    logs={"radius": True} # Set true for more bins
)


# Rays7

rp7_vol_1 = yt.create_profile(
    sp7_1,
    "radius",
    ["cell_volume", "radius", "matter_density", "density", "Dark_Matter_Density"], # 'dm_mass' also raises error here.
    units={"radius": "pc", "Dark_Matter_Density": "g/cm**3", "matter_density": "g/cm**3", "density": "g/cm**3"},
    weight_field='cell_volume',
    accumulation=True,
    logs={"radius": True} # Set true for more bins
)

rp7_vol_2 = yt.create_profile(
    sp7_2,
    "radius",
    ["radius", "matter_density", "density", "Dark_Matter_Density"], # 'dm_mass' also raises error here.
    units={"radius": "pc", "Dark_Matter_Density": "g/cm**3", "matter_density": "g/cm**3", "density": "g/cm**3"},
    weight_field='cell_volume',
    accumulation=True,
    logs={"radius": True} # Set true for more bins
)

rp7_vol_3 = yt.create_profile(
    sp7_3,
    "radius",
    ["cell_volume", "radius", "matter_density", "density", "Dark_Matter_Density"], # 'dm_mass' also raises error here.
    units={"radius": "pc", "Dark_Matter_Density": "g/cm**3", "matter_density": "g/cm**3", "density": "g/cm**3"},
    weight_field='cell_volume',
    accumulation=True,
    logs={"radius": True} # Set true for more bins
)


# Ray5

rp5_vol_1 = yt.create_profile(
    sp5_1,
    "radius",
    ["cell_volume", "radius", "matter_density", "density", "Dark_Matter_Density"], # 'dm_mass' also raises error here.
    units={"radius": "pc", "Dark_Matter_Density": "g/cm**3", "matter_density": "g/cm**3", "density": "g/cm**3"},
    weight_field='cell_volume',
    accumulation=True,
    logs={"radius": True} # Set true for more bins
)

rp5_vol_2 = yt.create_profile(
    sp5_2,
    "radius",
    ["cell_volume", "radius", "matter_density", "density", "Dark_Matter_Density"], # 'dm_mass' also raises error here.
    units={"radius": "pc", "Dark_Matter_Density": "g/cm**3", "matter_density": "g/cm**3", "density": "g/cm**3"},
    weight_field='cell_volume',
    accumulation=True,
    logs={"radius": True} # Set true for more bins
)

rp5_vol_3 = yt.create_profile(
    sp5_3,
    "radius",
    ["cell_volume", "radius", "matter_density", "density", "Dark_Matter_Density"], # 'dm_mass' also raises error here.
    units={"radius": "pc", "Dark_Matter_Density": "g/cm**3", "matter_density": "g/cm**3", "density": "g/cm**3"},
    weight_field='cell_volume',
    accumulation=True,
    logs={"radius": True} # Set true for more bins
)


# Set up fig and 1x4 subplots, removed figsize=(23,20)

fig = plt.figure()
fig, axs = plt.subplots(2, 2, sharex=True)

# Hide x labels and tick labels for all but bottom plot.

# 1) Density vs Radius

# Plot the gas density as a log-log plot using the default settings
axs[0,0].loglog(rp10_vol_1.x.value, rp10_vol_1["density"].value, color = 'r', linestyle = 'solid', label = 'rays10 1Myr')
axs[0,0].loglog(rp10_vol_2.x.value, rp10_vol_2["density"].value, color = 'r', linestyle = 'dashed', label = 'rays10 2Myr')
axs[0,0].loglog(rp10_vol_3.x.value, rp10_vol_3["density"].value, color = 'r', linestyle = 'dotted', label = 'rays10 3Myr')


axs[0,0].loglog(rp7_vol_1.x.value, rp7_vol_1["density"].value, color = 'b', linestyle = 'solid', label = 'rays7 1Myr')
axs[0,0].loglog(rp7_vol_2.x.value, rp7_vol_2["density"].value, color = 'b', linestyle = 'dashed', label = 'rays7 2Myr')
axs[0,0].loglog(rp7_vol_3.x.value, rp7_vol_3["density"].value, color = 'b', linestyle = 'dotted', label = 'rays7 3Myr')


axs[0,0].loglog(rp5_vol_1.x.value, rp5_vol_1["density"].value, color = 'g', linestyle = 'solid', label = 'rays5 1Myr')
axs[0,0].loglog(rp5_vol_2.x.value, rp5_vol_2["density"].value, color = 'g', linestyle = 'dashed', label = 'rays5 2Myr')
axs[0,0].loglog(rp5_vol_3.x.value, rp5_vol_3["density"].value, color = 'g', linestyle = 'dotted', label = 'rays5 3Myr')

# custom lines for legend
custom_lines = [Line2D([0], [0], color='black', linestyle = 'solid', lw=1), Line2D([0], [0], color='black', linestyle = 'dashed', lw=1), Line2D([0], [0], color='black', linestyle = 'dotted', lw=1), Line2D([0], [0], color='red', linestyle = 'solid', lw=1), Line2D([0], [0], color='blue', linestyle = 'solid', lw=1), Line2D([0], [0], color='green', linestyle = 'solid', lw=1)]


axs[0,0].set_ylabel(r"$\mathrm{\rho\ (g \ cm^{-3})}$", fontsize=14)
axs[0,0].legend(custom_lines, ['1 Myr', '2 Myr', '3 Myr', 'rays10', 'rays7', 'rays5.1'], loc = "lower right", fontsize=14, ncol=2)

axs[0,0].set_xticklabels([])
axs[0,0].tick_params(axis="x", which='minor', length = 4, direction="in")
axs[0,0].tick_params(axis="x", which='major', width=2, length=7, direction="in")




# 2) Temperature vs. Radius


axs[0,1].loglog(rp10_mass_1_rad, rp10_mass_1_temp, color = 'r', linestyle = 'solid', label = 'rays10 1 Myr')
axs[0,1].loglog(rp10_mass_2_rad, rp10_mass_2_temp, color = 'r', linestyle = 'dashed', label = 'rays10 2 Myr')
axs[0,1].loglog(rp10_mass_3_rad, rp10_mass_3_temp, color = 'r', linestyle = 'dotted', label = 'rays10 3 Myr')

axs[0,1].loglog(rp7_mass_1_rad, rp7_mass_1_temp, color = 'b', linestyle = 'solid', label = 'rays7 1 Myr')
axs[0,1].loglog(rp7_mass_2_rad, rp7_mass_2_temp, color = 'b', linestyle = 'dashed', label = 'rays7 2 Myr')
axs[0,1].loglog(rp7_mass_3_rad, rp7_mass_3_temp, color = 'b', linestyle = 'dotted', label = 'rays7 3 Myr')

axs[0,1].loglog(rp5_mass_1_rad, rp5_mass_1_temp, color = 'g', linestyle = 'solid', label = 'rays5 1 Myr')
axs[0,1].loglog(rp5_mass_2_rad, rp5_mass_2_temp, color = 'g', linestyle = 'dashed', label = 'rays5 2 Myr')
axs[0,1].loglog(rp5_mass_3_rad, rp5_mass_3_temp, color = 'g', linestyle = 'dotted', label = 'rays5 3 Myr')


axs[0,1].set_xlabel([])
axs[0,1].set_ylabel(r"$\mathrm{T\ (K)}$", fontsize=14)
axs[0,1].legend(custom_lines, ['1 Myr', '2 Myr', '3 Myr', 'rays10', 'rays7', 'rays5.1'], loc = "lower left", fontsize=14, ncol=2)

axs[0,1].set_xticklabels([])
axs[0,1].tick_params(axis="x", which='minor', length = 4, direction="in")
axs[0,1].tick_params(axis="x", which='major', width=2, length=7, direction="in")
axs[0,1].yaxis.tick_right()
axs[0,1].yaxis.set_label_position("right")



# 3) H2 molecule fraction vs. Radius

axs[1,0].loglog(rp10_mass_1_rad, rp10_mass_1_h2, color = 'r', linestyle = 'solid', label = 'rays10 1Myr')
axs[1,0].loglog(rp10_mass_2_rad, rp10_mass_2_h2, color = 'r', linestyle = 'dashed', label = 'rays10 2Myr')
axs[1,0].loglog(rp10_mass_3_rad, rp10_mass_3_h2, color = 'r', linestyle = 'dotted', label = 'rays10 3Myr')


axs[1,0].loglog(rp7_mass_1_rad, rp7_mass_1_h2, color = 'b', linestyle = 'solid', label = 'rays7 1Myr')
axs[1,0].loglog(rp7_mass_2_rad, rp7_mass_2_h2, color = 'b', linestyle = 'dashed', label = 'rays7 2Myr')
axs[1,0].loglog(rp7_mass_3_rad, rp7_mass_3_h2, color = 'b', linestyle = 'dotted', label = 'rays7 3Myr')


axs[1,0].loglog(rp5_mass_1_rad, rp5_mass_1_h2, color = 'g', linestyle = 'solid', label = 'rays5 1Myr')
axs[1,0].loglog(rp5_mass_2_rad, rp5_mass_2_h2, color = 'g', linestyle = 'dashed', label = 'rays5 2Myr')
axs[1,0].loglog(rp5_mass_3_rad, rp5_mass_3_h2, color = 'g', linestyle = 'dotted', label = 'rays5 3Myr')


axs[1,0].set_xlabel(r"$\mathrm{r\ (pc)}$", fontsize=14)
axs[1,0].set_ylabel(r"$f_{H2}$", fontsize=14)
axs[1,0].legend(custom_lines, ['1 Myr', '2 Myr', '3 Myr', 'rays10', 'rays7', 'rays5.1'], loc = "lower right", ncol=2)

axs[1,0].tick_params(axis="x", which='minor', length = 4)
axs[1,0].tick_params(axis="x", which='major', width=2, length=7)



# 4) Radial velocity vs. Radius

# first we need to find the bulk velocity and subtract it from the vels
for sp in all_spheres:
    bulk_vel = sp.quantities.bulk_velocity()
    sp.set_field_parameter("bulk_velocity", bulk_vel)
    

axs[1,1].semilogx(rp10_mass_1.x.value, rp10_mass_1["radial_velocity"].in_units("km/s").value, color = 'r', linestyle = 'solid', label = 'rays10 1My')
axs[1,1].semilogx(rp10_mass_2.x.value, rp10_mass_2["radial_velocity"].in_units("km/s").value, color = 'r', linestyle = 'dashed', label = 'rays10 2Myr')
axs[1,1].semilogx(rp10_mass_3.x.value, rp10_mass_3["radial_velocity"].in_units("km/s").value, color = 'r', linestyle = 'dotted', label = 'rays10 3Myr')


axs[1,1].semilogx(rp7_mass_1.x.value, rp7_mass_1["radial_velocity"].in_units("km/s").value, color = 'b', linestyle = 'solid', label = 'rays7 1Myr')
axs[1,1].semilogx(rp7_mass_2.x.value, rp7_mass_2["radial_velocity"].in_units("km/s").value, color = 'b', linestyle = 'dashed', label = 'rays7 2Myr')
axs[1,1].semilogx(rp7_mass_3.x.value, rp7_mass_3["radial_velocity"].in_units("km/s").value, color = 'b', linestyle = 'dotted', label = 'rays7 3Myr')


axs[1,1].semilogx(rp5_mass_1.x.value, rp5_mass_1["radial_velocity"].in_units("km/s").value, color = 'g', linestyle = 'solid', label = 'rays5 1Myr')
axs[1,1].semilogx(rp5_mass_2.x.value, rp5_mass_2["radial_velocity"].in_units("km/s").value, color = 'g', linestyle = 'dashed', label = 'rays5 2Myr')
axs[1,1].semilogx(rp5_mass_3.x.value, rp5_mass_3["radial_velocity"].in_units("km/s").value, color = 'g', linestyle = 'dotted', label = 'rays5 3Myr')

axs[1,1].set_xlabel(r"$\mathrm{r\ (pc)}$", fontsize=14)
axs[1,1].set_ylabel(r"$\mathrm{Radial\ velocity\ (km/s)} $", fontsize=14)
axs[1,1].legend(custom_lines, ['1 Myr', '2 Myr', '3 Myr', 'rays10', 'rays7', 'rays5.1'], loc = "lower right", ncol=2)

axs[1,1].tick_params(axis="x", which='minor', length = 4)
axs[1,1].tick_params(axis="x", which='major', width=2, length=7)
axs[1,1].yaxis.tick_right()
axs[1,1].yaxis.set_label_position("right")




# save 4 plots in in 1 figure

fig = plt.gcf()
fig.subplots_adjust(wspace=0, hspace=0)
fig.set_size_inches(20.5, 15.5)
fig.savefig('supernova_before_plot_2x2.pdf', dpi=100)
